# تطوير نظام إدارة الكنيسة - صفحات أمين الخدمة

## الصفحات الجديدة المضافة

### 1. صفحة المواظبين على الحضور (4 أسابيع متتالية)
**المسار:** `/consecutive-attendance`
**الأذونات:** أمين الخدمة والأدمن فقط

#### المميزات:
- عرض الأطفال الذين حضروا 4 أسابيع متتالية أو أكثر
- رسم بياني للحضور الأسبوعي لآخر 4 جمعات
- إحصائيات سريعة:
  - عدد الأطفال المواظبين
  - متوسط أسابيع المواظبة
  - أعلى عدد أسابيع مواظبة
- ترتيب الأطفال حسب عدد أسابيع الحضور المتتالي
- تصنيف الأطفال (جيد جداً، ممتاز، ممتاز جداً)
- إمكانية التصفية حسب الفصل
- توزيع المواظبة حسب الأسابيع والفصول

#### API المستخدم:
- `GET /api/statistics/consecutive-attendance` - للحصول على الأطفال المواظبين
- `GET /api/attendance/children-with-status` - للحصول على بيانات الحضور الأسبوعي

---

### 2. صفحة متابعة الخدام
**المسار:** `/servants-follow-up`
**الأذونات:** أمين الخدمة والأدمن فقط

#### المميزات:
- عرض الخدام الذين غابوا 3 أسابيع متتالية أو أكثر
- إحصائيات عامة للخدام:
  - إجمالي الخدام
  - الحاضرون اليوم
  - معدل الحضور
  - عدد الخدام المحتاجين متابعة
- تصنيف الحالات حسب الأولوية:
  - يحتاج متابعة (3 أسابيع)
  - عاجل (4-5 أسابيع)
  - عاجل جداً (6+ أسابيع)
- أدوات التواصل:
  - زر اتصال مباشر
  - زر واتساب
- عرض تاريخ آخر حضور لكل خادم
- نصائح للمتابعة والتواصل

#### API المستخدم:
- `GET /api/servants/statistics/general` - للإحصائيات العامة
- `GET /api/servants/statistics/follow-up` - للخدام المحتاجين متابعة

---

### 3. لوحة تحكم أمين الخدمة
**المسار:** `/service-leader-dashboard`
**الأذونات:** أمين الخدمة والأدمن فقط

#### المميزات:
- نظرة شاملة على جميع إحصائيات الخدمة
- بطاقات إحصائية سريعة:
  - إجمالي الأطفال ومعدل الحضور
  - إجمالي الخدام ومعدل الحضور
  - عدد الأطفال المواظبين
  - عدد الخدام المحتاجين متابعة
- روابط سريعة للصفحات المهمة:
  - صفحة المواظبين على الحضور
  - صفحة متابعة الخدام
  - الإحصائيات التفصيلية
- ملخص حالة الأطفال والخدام
- تنبيهات للحالات التي تحتاج اهتمام
- أشرطة تقدم لمعدلات الحضور

---

### 4. مكونات الرسوم البيانية
**الملف:** `/src/components/Charts.tsx`

#### المكونات المتاحة:
- `SimpleBarChart` - رسم بياني بأعمدة بسيط
- `ProgressBar` - شريط تقدم مع نسبة مئوية
- `StatCard` - بطاقة إحصائية مع أيقونة واتجاه
- `AttendanceCalendar` - تقويم حضور شهري

---

## تحديث الداشبورد الرئيسي

تم إضافة البطاقات التالية لأمين الخدمة في الداشبورد الرئيسي:
1. لوحة تحكم أمين الخدمة
2. المواظبون على الحضور (4 أسابيع)
3. متابعة الخدام

---

## الـ APIs المستخدمة

### 1. API الحضور المتتالي
```
GET /api/statistics/consecutive-attendance
```
- يرجع قائمة بالأطفال المواظبين لـ 4 أسابيع أو أكثر
- يدعم التصفية حسب الفصل
- يطبق صلاحيات المستخدم

### 2. API إحصائيات الخدام العامة
```
GET /api/servants/statistics/general
```
- يرجع إجمالي الخدام ومعدل الحضور
- للأدمن وأمين الخدمة فقط

### 3. API متابعة الخدام
```
GET /api/servants/statistics/follow-up
```
- يرجع الخدام الذين غابوا 3 أسابيع متتالية أو أكثر
- يتضمن معلومات الاتصال وتاريخ آخر حضور

### 4. API حضور الأطفال مع الحالة
```
GET /api/attendance/children-with-status?date=YYYY-MM-DD&classId=ID
```
- يرجع الأطفال مع حالة الحضور لتاريخ محدد
- يدعم التصفية حسب الفصل

---

## الأذونات والأمان

- جميع الصفحات الجديدة محمية بنظام الأذونات
- أمين الخدمة والأدمن فقط يمكنهم الوصول لهذه الصفحات
- الخدام ومدرسو الفصول يتم إعادة توجيههم للصفحة المناسبة
- جميع الـ APIs تطبق التحقق من الصلاحيات

---

## تحسينات الأداء

- استخدام `lean()` في MongoDB للاستعلامات السريعة
- تجميع البيانات في استعلام واحد بدلاً من استعلامات متعددة
- تخزين مؤقت للبيانات المحسوبة
- تحديد عدد النتائج لتجنب التحميل الزائد

---

## التقنيات المستخدمة

- **Frontend:** Next.js 14, TypeScript, Tailwind CSS
- **Backend:** Node.js, Express, MongoDB
- **المصادقة:** JWT Tokens
- **الحالة:** React Context API
- **التنقل:** Next.js App Router
- **الأيقونات:** Emoji Unicode
- **التخطيط:** CSS Grid & Flexbox

---

## ملاحظات تطويرية

1. جميع النصوص باللغة العربية مع دعم RTL
2. التصميم responsive ويعمل على جميع الشاشات
3. تنفيذ loading states وmessages الأخطاء
4. استخدام TypeScript للـ type safety
5. تطبيق best practices للـ accessibility
6. كود منظم ومعلق للصيانة السهلة

---

## الخطوات التالية المقترحة

1. إضافة تصدير PDF للتقارير
2. إشعارات push للحالات العاجلة
3. تقارير شهرية آلية
4. تكامل مع WhatsApp Business API
5. dashboard متقدم بالمزيد من الرسوم البيانية
6. نظام تتبع المكالمات والمتابعة
